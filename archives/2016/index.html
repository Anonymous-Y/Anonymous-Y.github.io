<!DOCTYPE HTML>

<html lang="en">
  
<head><meta name="generator" content="Hexo 3.9.0">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  
  <title>Archives: 2016 | Zichao Yang&#39;s Blog</title>
  <meta name="author" content="Zichao Yang">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="Zichao Yang&#39;s Blog">

  
    <meta property="og:image" content="undefined">
  

  
    <meta http-equiv="Content-Language" content="en">
  

  <link href="/img/32.png" rel="icon">
  
    <link rel="apple-touch-icon" href="/img/16.png">
    <link rel="apple-touch-icon-precomposed" href="/img/16.png">
    

  <link rel="alternate" href="/atom.xml" title="Zichao Yang&#39;s Blog" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  
  <style type="text/css">
  /* Tim Pietrusky advanced checkbox hack (Android <= 4.1.2) */
body{ -webkit-animation: bugfix infinite 1s; }
@-webkit-keyframes bugfix { from {padding:0;} to {padding:0;} }

  

  
    article .post-content-index .entry{max-height: 550px; overflow:hidden;}
  
</style>

  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'null', 'auto');
  ga('send', 'pageview');
 
</script>




  
    
      <link href="http://fonts.googleapis.com/css?family=Open+Sans:300,400|Playball" rel="stylesheet" type="text/css">
    
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
  <script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.11.1.min.js"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->

  



</head>
</html>

<body>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><header id="header" class="inner"><div class="padding">
	<div class="alignleft logo">
	  <h1><a href="/">Zichao Yang&#39;s Blog</a></h1>
	</div>
	<nav id="main-nav" class="alignright">
		<input type="checkbox" id="toggle" />
		<label for="toggle" class="toggle" data-open="Main Menu" data-close="Close Menu" onclick><i class="fa fa-bars"></i></label>
	  <ul class="menu">
	    
	      <li><a href="/archives">My Posts</a></li>
	    
	    
	  </ul>
	</nav>
	<div class="clearfix"></div>
</div>
</header>
  <div id="page-heading-wrap">
  	<div class="inner">
      <div class="padding">
    		
          <h2>Economist in Training, Cryptocurrency Enthusiast &amp; Amateur Coder</h2>
        
      </div>
  	</div>
  </div>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper" class="padding">
<h2 class="archive-title">2016</h2>


  
    <article class="post">
  
  
    <div class="post-content-index">
  
      
        <header>
          <div class="icon"></div>
            
    
      <h1 class="title transition"><a href="/2016/05/28/threshold/">Introduction to Panel Threshold Model</a></h1>
    
  
          <ul>
            <li>
              <span class="heading-span">Posted on: </span>
              <time datetime="2016-05-28T17:18:42.000Z">2016-05-28</time>
            </li>
            
              <li>
                <span class="heading-span">By: </span>

                
                  <a href="/">Zichao Yang</a>
                

              </li>
            
            <li>
              <span class="heading-span">With: </span>
              
                <a href="/2016/05/28/threshold/#disqus_thread">Comments</a>

              
          </ul>
        </header>
      
      <div class="entry">
        
          
            <ul>
<li>These are my slides written for the graduate course of Intermediate Econometrics. The whole project is based on <a href="http://www.sciencedirect.com/science/article/pii/S0304407699000251" target="_blank" rel="noopener">Threshold effects in non-dynamic panels: Estimation, testing, and inference (Hansen, 1999)</a>  </li>
</ul>
<ul>
<li><strong>Part One: Slides</strong>  </li>
</ul>
<p><img src="https://raw.githubusercontent.com/Anonymous-Y/BlogImage/master/threshold/presentation_%E9%A1%B5%E9%9D%A2_01.jpg" alt="slide 1">  </p>
<p><img src="https://raw.githubusercontent.com/Anonymous-Y/BlogImage/master/threshold/presentation_%E9%A1%B5%E9%9D%A2_02.jpg" alt="slide 2">  </p>
<p><img src="https://raw.githubusercontent.com/Anonymous-Y/BlogImage/master/threshold/presentation_%E9%A1%B5%E9%9D%A2_03.jpg" alt="slide 3">  </p>
<p><img src="https://raw.githubusercontent.com/Anonymous-Y/BlogImage/master/threshold/presentation_%E9%A1%B5%E9%9D%A2_04.jpg" alt="slide 4">  </p>
<p><img src="https://raw.githubusercontent.com/Anonymous-Y/BlogImage/master/threshold/presentation_%E9%A1%B5%E9%9D%A2_05.jpg" alt="slide 5">  </p>
<p><img src="https://raw.githubusercontent.com/Anonymous-Y/BlogImage/master/threshold/presentation_%E9%A1%B5%E9%9D%A2_06.jpg" alt="slide 6">  </p>
<p><img src="https://raw.githubusercontent.com/Anonymous-Y/BlogImage/master/threshold/presentation_%E9%A1%B5%E9%9D%A2_07.jpg" alt="slide 7">  </p>
<p><img src="https://raw.githubusercontent.com/Anonymous-Y/BlogImage/master/threshold/presentation_%E9%A1%B5%E9%9D%A2_08.jpg" alt="slide 8">  </p>
<p><img src="https://raw.githubusercontent.com/Anonymous-Y/BlogImage/master/threshold/presentation_%E9%A1%B5%E9%9D%A2_09.jpg" alt="slide 9">  </p>
<p><img src="https://raw.githubusercontent.com/Anonymous-Y/BlogImage/master/threshold/presentation_%E9%A1%B5%E9%9D%A2_10.jpg" alt="slide 10">  </p>
<p><img src="https://raw.githubusercontent.com/Anonymous-Y/BlogImage/master/threshold/presentation_%E9%A1%B5%E9%9D%A2_11.jpg" alt="slide 11">  </p>
<p><img src="https://raw.githubusercontent.com/Anonymous-Y/BlogImage/master/threshold/presentation_%E9%A1%B5%E9%9D%A2_12.jpg" alt="slide 12">  </p>
<p><img src="https://raw.githubusercontent.com/Anonymous-Y/BlogImage/master/threshold/presentation_%E9%A1%B5%E9%9D%A2_13.jpg" alt="slide 13">  </p>
<p><img src="https://raw.githubusercontent.com/Anonymous-Y/BlogImage/master/threshold/presentation_%E9%A1%B5%E9%9D%A2_14.jpg" alt="slide 14">  </p>
<p><img src="https://raw.githubusercontent.com/Anonymous-Y/BlogImage/master/threshold/presentation_%E9%A1%B5%E9%9D%A2_15.jpg" alt="slide 15">  </p>
<p><img src="https://raw.githubusercontent.com/Anonymous-Y/BlogImage/master/threshold/presentation_%E9%A1%B5%E9%9D%A2_16.jpg" alt="slide 16">  </p>
<p><img src="https://raw.githubusercontent.com/Anonymous-Y/BlogImage/master/threshold/presentation_%E9%A1%B5%E9%9D%A2_17.jpg" alt="slide 17">  </p>
<p><img src="https://raw.githubusercontent.com/Anonymous-Y/BlogImage/master/threshold/presentation_%E9%A1%B5%E9%9D%A2_18.jpg" alt="slide 18">  </p>
<p><img src="https://raw.githubusercontent.com/Anonymous-Y/BlogImage/master/threshold/presentation_%E9%A1%B5%E9%9D%A2_19.jpg" alt="slide 19">  </p>
<p><img src="https://raw.githubusercontent.com/Anonymous-Y/BlogImage/master/threshold/presentation_%E9%A1%B5%E9%9D%A2_20.jpg" alt="slide 20">  </p>
<p><img src="https://raw.githubusercontent.com/Anonymous-Y/BlogImage/master/threshold/presentation_%E9%A1%B5%E9%9D%A2_21.jpg" alt="slide 21">  </p>
<p><img src="https://raw.githubusercontent.com/Anonymous-Y/BlogImage/master/threshold/presentation_%E9%A1%B5%E9%9D%A2_22.jpg" alt="slide 22">  </p>
<p><img src="https://raw.githubusercontent.com/Anonymous-Y/BlogImage/master/threshold/presentation_%E9%A1%B5%E9%9D%A2_23.jpg" alt="slide 23">  </p>
<p><img src="https://raw.githubusercontent.com/Anonymous-Y/BlogImage/master/threshold/presentation_%E9%A1%B5%E9%9D%A2_24.jpg" alt="slide 24">  </p>
<p><img src="https://raw.githubusercontent.com/Anonymous-Y/BlogImage/master/threshold/presentation_%E9%A1%B5%E9%9D%A2_25.jpg" alt="slide 25">  </p>
<p><img src="https://raw.githubusercontent.com/Anonymous-Y/BlogImage/master/threshold/presentation_%E9%A1%B5%E9%9D%A2_26.jpg" alt="slide 26">  </p>
<p><img src="https://raw.githubusercontent.com/Anonymous-Y/BlogImage/master/threshold/presentation_%E9%A1%B5%E9%9D%A2_27.jpg" alt="slide 27">  </p>
<p><img src="https://raw.githubusercontent.com/Anonymous-Y/BlogImage/master/threshold/presentation_%E9%A1%B5%E9%9D%A2_28.jpg" alt="slide 28">  </p>
<p><img src="https://raw.githubusercontent.com/Anonymous-Y/BlogImage/master/threshold/presentation_%E9%A1%B5%E9%9D%A2_29.jpg" alt="slide 29">  </p>
<p><img src="https://raw.githubusercontent.com/Anonymous-Y/BlogImage/master/threshold/presentation_%E9%A1%B5%E9%9D%A2_30.jpg" alt="slide 30">  </p>
<ul>
<li><strong>Part Two: R code for this lecture</strong><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#First of all, we need to generate the data of y,x,n</span></span><br><span class="line">set.seed(<span class="number">123</span>) <span class="comment"># I set the seed for the sake of repeatability</span></span><br><span class="line">e=rnorm(<span class="number">100</span>,mean=<span class="number">0</span>,sd=<span class="number">1</span>)</span><br><span class="line">x=rnorm(<span class="number">100</span>,mean=<span class="number">0</span>,sd=<span class="number">3</span>^<span class="number">2</span>)</span><br><span class="line">n=<span class="number">1</span>:<span class="number">100</span></span><br><span class="line">y=rep(<span class="number">0</span>,times=<span class="number">100</span>)</span><br><span class="line">y[<span class="number">1</span>:<span class="number">50</span>]=<span class="number">1</span>+<span class="number">2</span>*x[<span class="number">1</span>:<span class="number">50</span>]+e[<span class="number">1</span>:<span class="number">50</span>]</span><br><span class="line">y[<span class="number">51</span>:<span class="number">100</span>]=<span class="number">1</span>-<span class="number">2</span>*x[<span class="number">51</span>:<span class="number">100</span>]+e[<span class="number">51</span>:<span class="number">100</span>]</span><br><span class="line">data=data.frame(n,x,y,e)</span><br><span class="line"></span><br><span class="line"><span class="comment">#Then we can plot out the relationship between y and n, as well as y and x.</span></span><br><span class="line"><span class="keyword">library</span>(ggplot2)</span><br><span class="line">p1=ggplot(data,aes(x=n,y=y))+geom_point()</span><br><span class="line">p2=ggplot(data,aes(x=x,y=y))+geom_point()</span><br><span class="line">p1</span><br><span class="line">p2</span><br><span class="line"></span><br><span class="line"><span class="comment">#Regression results</span></span><br><span class="line"><span class="comment">#Suppose we do not aware the existance of thereshold effect</span></span><br><span class="line">reg1=lm(y~x,data)</span><br><span class="line">summary(reg1)</span><br><span class="line"></span><br><span class="line"><span class="comment">#If we know the thereshold and seprate the whole data frame into two groups,</span></span><br><span class="line"><span class="comment">#then conduct regressions separately.</span></span><br><span class="line">data1=subset(data, n&lt;=<span class="number">50</span>)</span><br><span class="line">data2=subset(data,n&gt;<span class="number">50</span>)</span><br><span class="line">reg2=lm(y~x,data1)</span><br><span class="line">reg3=lm(y~x,data2)</span><br><span class="line">summary(reg2)</span><br><span class="line">summary(reg3)</span><br><span class="line"></span><br><span class="line"><span class="comment">#If we do not know where the thereshold is, then how?</span></span><br><span class="line">reg=list()</span><br><span class="line">rss=array()</span><br><span class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1</span>:<span class="number">99</span>)</span><br><span class="line">&#123;</span><br><span class="line">  dum=x</span><br><span class="line">  dum[(i+<span class="number">1</span>):<span class="number">100</span>]=<span class="number">0</span></span><br><span class="line">  reg[[i]]=lm(y~x+dum)</span><br><span class="line">  rss[i]=sum(residuals(reg[[i]])^<span class="number">2</span>)</span><br><span class="line">&#125;</span><br><span class="line">order(rss)</span><br><span class="line"></span><br><span class="line">Rss=data.frame(n=<span class="number">1</span>:<span class="number">99</span>,rss)</span><br><span class="line">ggplot(Rss,aes(x=n,y=rss))+geom_point()</span><br><span class="line"></span><br><span class="line"><span class="comment">######################</span></span><br><span class="line"><span class="comment">######################</span></span><br><span class="line"><span class="comment">#Now if we have two theresholds, we can still use</span></span><br><span class="line"><span class="comment">#nested loop to discern these two theresholds. </span></span><br><span class="line"><span class="comment">#However Hensen proposed a more elegant solution.</span></span><br><span class="line"><span class="comment">#Prepare the data</span></span><br><span class="line"></span><br><span class="line">set.seed(<span class="number">456</span>) <span class="comment"># I set the seed for the sake of repeatability</span></span><br><span class="line">e=rnorm(<span class="number">100</span>,mean=<span class="number">0</span>,sd=<span class="number">1</span>)</span><br><span class="line">x=rnorm(<span class="number">100</span>,mean=<span class="number">0</span>,sd=<span class="number">3</span>^<span class="number">2</span>)</span><br><span class="line">n=<span class="number">1</span>:<span class="number">100</span></span><br><span class="line">y=rep(<span class="number">0</span>,times=<span class="number">100</span>)</span><br><span class="line">y[<span class="number">1</span>:<span class="number">30</span>]=<span class="number">1</span>+<span class="number">2</span>*x[<span class="number">1</span>:<span class="number">30</span>]+e[<span class="number">1</span>:<span class="number">30</span>]</span><br><span class="line">y[<span class="number">31</span>:<span class="number">60</span>]=<span class="number">1</span>-<span class="number">2</span>*x[<span class="number">31</span>:<span class="number">60</span>]+e[<span class="number">31</span>:<span class="number">60</span>]</span><br><span class="line">y[<span class="number">61</span>:<span class="number">100</span>]=<span class="number">1</span>+<span class="number">4</span>*x[<span class="number">61</span>:<span class="number">100</span>]+e[<span class="number">61</span>:<span class="number">100</span>]</span><br><span class="line">data=data.frame(n,x,y,e)</span><br><span class="line"></span><br><span class="line"><span class="comment">#Then we can plot out the relationship between y and n, as well as y and x.</span></span><br><span class="line"><span class="keyword">library</span>(ggplot2)</span><br><span class="line">p1=ggplot(data,aes(x=n,y=y))+geom_point()</span><br><span class="line">p2=ggplot(data,aes(x=x,y=y))+geom_point()</span><br><span class="line">p1</span><br><span class="line">p2</span><br><span class="line"></span><br><span class="line"><span class="comment">#Now we use the method proposed by Hensen to discern theresholds</span></span><br><span class="line"><span class="comment">#pinpoint the first thereshold</span></span><br><span class="line">reg=list()</span><br><span class="line">rss1=array()</span><br><span class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1</span>:<span class="number">99</span>)</span><br><span class="line">&#123;</span><br><span class="line">  dum=x</span><br><span class="line">  dum[(i+<span class="number">1</span>):<span class="number">100</span>]=<span class="number">0</span></span><br><span class="line">  reg[[i]]=lm(y~x+dum)</span><br><span class="line">  rss1[i]=sum(residuals(reg[[i]])^<span class="number">2</span>)</span><br><span class="line">&#125;</span><br><span class="line">which.min(rss1)</span><br><span class="line"><span class="comment">#plot the figure</span></span><br><span class="line">Rss1=data.frame(n=<span class="number">1</span>:<span class="number">99</span>,rss1)</span><br><span class="line">ggplot(Rss1,aes(x=n,y=rss1))+geom_point()</span><br><span class="line"></span><br><span class="line"><span class="comment">#pinpoint the second thereshold</span></span><br><span class="line">reg2=list()</span><br><span class="line">rss2=array()</span><br><span class="line"><span class="keyword">for</span>(i <span class="keyword">in</span> <span class="number">1</span>:<span class="number">99</span>)</span><br><span class="line">&#123;</span><br><span class="line">  dum1=x</span><br><span class="line">  dum2=x</span><br><span class="line">  left=min(i,which.min(rss1))</span><br><span class="line">  right=max(i,which.min(rss1))</span><br><span class="line">  dum1[(left+<span class="number">1</span>):<span class="number">100</span>]=<span class="number">0</span></span><br><span class="line">  dum2[<span class="number">1</span>:right]=<span class="number">0</span></span><br><span class="line">  reg2[[i]]=lm(y~x+dum1+dum2)</span><br><span class="line">  rss2[i]=sum(residuals(reg2[[i]])^<span class="number">2</span>)</span><br><span class="line">&#125;</span><br><span class="line">which.min(rss2)</span><br><span class="line"><span class="comment">#plot the figure</span></span><br><span class="line">Rss2=data.frame(n=<span class="number">1</span>:<span class="number">99</span>,rss2)</span><br><span class="line">ggplot(Rss2,aes(x=n,y=rss2))+geom_point()</span><br><span class="line"></span><br><span class="line"><span class="comment">#pinpoint the first thereshold again</span></span><br><span class="line">reg3=list()</span><br><span class="line">rss3=array()</span><br><span class="line"><span class="keyword">for</span>(i <span class="keyword">in</span> <span class="number">1</span>:<span class="number">99</span>)</span><br><span class="line">&#123;</span><br><span class="line">  dum1=x</span><br><span class="line">  dum2=x</span><br><span class="line">  left=min(i,which.min(rss2))</span><br><span class="line">  right=max(i,which.min(rss2))</span><br><span class="line">  dum1[(left+<span class="number">1</span>):<span class="number">100</span>]=<span class="number">0</span></span><br><span class="line">  dum2[<span class="number">1</span>:right]=<span class="number">0</span></span><br><span class="line">  reg3[[i]]=lm(y~x+dum1+dum2)</span><br><span class="line">  rss3[i]=sum(residuals(reg3[[i]])^<span class="number">2</span>)</span><br><span class="line">&#125;</span><br><span class="line">which.min(rss3)</span><br><span class="line"><span class="comment">#plot the figure</span></span><br><span class="line">Rss3=data.frame(n=<span class="number">1</span>:<span class="number">99</span>,rss3)</span><br><span class="line">ggplot(Rss3,aes(x=n,y=rss3))+geom_point()</span><br><span class="line"></span><br><span class="line"><span class="comment"># put those aboving figures into one picture.</span></span><br><span class="line">all=rbind(data.frame(n=<span class="number">1</span>:<span class="number">99</span>,rss=rss1,t=<span class="string">"loop 1"</span>),data.frame(n=<span class="number">1</span>:<span class="number">99</span>,rss=rss2,t=<span class="string">"loop 2"</span>),data.frame(n=<span class="number">1</span>:<span class="number">99</span>,rss=rss3,t=<span class="string">"loop 3"</span>))</span><br><span class="line">p=ggplot(all, aes(x=n,y=rss))</span><br><span class="line">p+geom_path(aes(position=t,color=t))+geom_point(aes(position=t,color=t))</span><br><span class="line"></span><br><span class="line"><span class="comment">#bootstrap, in this case, we only consider one threshold.</span></span><br><span class="line">set.seed(<span class="number">123</span>) <span class="comment"># I set the seed for the sake of repeatability</span></span><br><span class="line">e=rnorm(<span class="number">100</span>,mean=<span class="number">0</span>,sd=<span class="number">1</span>)</span><br><span class="line">x=rnorm(<span class="number">100</span>,mean=<span class="number">0</span>,sd=<span class="number">3</span>^<span class="number">2</span>)</span><br><span class="line">n=<span class="number">1</span>:<span class="number">100</span></span><br><span class="line">y=rep(<span class="number">0</span>,times=<span class="number">100</span>)</span><br><span class="line">y[<span class="number">1</span>:<span class="number">50</span>]=<span class="number">1</span>+<span class="number">2</span>*x[<span class="number">1</span>:<span class="number">50</span>]+e[<span class="number">1</span>:<span class="number">50</span>]</span><br><span class="line">y[<span class="number">51</span>:<span class="number">100</span>]=<span class="number">1</span>-<span class="number">2</span>*x[<span class="number">51</span>:<span class="number">100</span>]+e[<span class="number">51</span>:<span class="number">100</span>]</span><br><span class="line">data=data.frame(n,x,y,e)</span><br><span class="line"></span><br><span class="line">breg1=lm(y~x,data)</span><br><span class="line">s0=sum(residuals(breg1)^<span class="number">2</span>)</span><br><span class="line"><span class="keyword">library</span>(boot)</span><br><span class="line">fvalue=<span class="keyword">function</span>(data,indices)&#123;</span><br><span class="line">  d=data[indices,]</span><br><span class="line">  bregloop=list()</span><br><span class="line">  brss=array()</span><br><span class="line">  <span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1</span>:<span class="number">99</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    dum=d$x</span><br><span class="line">    dum[(i+<span class="number">1</span>):<span class="number">100</span>]=<span class="number">0</span></span><br><span class="line">    bregloop[[i]]=lm(y~x+dum,data=d)</span><br><span class="line">    brss[i]=sum(residuals(bregloop[[i]])^<span class="number">2</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  a=which.min(brss)</span><br><span class="line">  dum=d$x</span><br><span class="line">  dum[(a+<span class="number">1</span>):<span class="number">100</span>]=<span class="number">0</span></span><br><span class="line">  breg2=lm(y~x+dum,data=d)</span><br><span class="line">  s1=sum(residuals(breg2)^<span class="number">2</span>)</span><br><span class="line">  f=(s0/s1-<span class="number">1</span>)*(<span class="number">100</span>-<span class="number">1</span>)</span><br><span class="line">  <span class="keyword">return</span>(f)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">result=boot(data=data,fvalue,R=<span class="number">99</span>)</span><br><span class="line">f=result$t</span><br><span class="line"></span><br><span class="line">result=boot(data=data,fvalue,R=<span class="number">99</span>,formula1=y~x+dum)</span><br><span class="line">f=result$t</span><br><span class="line"></span><br><span class="line"><span class="comment">#the real f0</span></span><br><span class="line">dum=data$x</span><br><span class="line">dum[<span class="number">51</span>:<span class="number">100</span>]=<span class="number">0</span></span><br><span class="line">reg4=lm(y~x+dum,data)</span><br><span class="line">rss4=sum(residuals(reg4)^<span class="number">2</span>)</span><br><span class="line">f0=(s0/rss4-<span class="number">1</span>)*(<span class="number">100</span>-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">table(f&gt;f0) <span class="comment"># so the p-value=0, we should reject H0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##last question, get the confidence intervals for gamma</span></span><br><span class="line">LR=(rss-rss4)/(rss4/(<span class="number">100</span>-<span class="number">1</span>))</span><br><span class="line">order(LR)</span><br><span class="line">c=-<span class="number">2</span>*log(<span class="number">1</span>-sqrt(<span class="number">1</span>-<span class="number">0.01</span>)) <span class="comment">#we set the asymptotic level alpha at 1%</span></span><br><span class="line">LR[LR&lt;c]</span><br></pre></td></tr></table></figure>
</li>
</ul>

          
        
      </div>
      <footer>
        
          <div class="alignright">
            <a href="/2016/05/28/threshold/#more" class="more-link">Continue Reading<i class="fa fa-long-arrow-right fa-1"></i></a>
          </div>
        
        <div class="clearfix"></div>
      </footer>
    </div>
</article>



  

  <nav id="pagination">
  
  
  <div class="clearfix"></div>
</nav>




   </div></div>
    <aside id="sidebar" class="alignright"><div class="padding">
	
	  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="Search">
    <input type="hidden" name="q" value="site:yoursite.com">
  </form>
</div>
	
	  
<div class="widget recent-post">
  <h3 class="title">Recent Posts</h3>
  <ul class="entry">
    
      <li>
        <a href="/2016/05/28/threshold/">Introduction to Panel Threshold Model</a>
      </li>
    
      <li>
        <a href="/2015/12/13/r-intro-3/">R Introduction Part 3</a>
      </li>
    
      <li>
        <a href="/2015/12/12/r-intro-2/">R Introduction Part 2</a>
      </li>
    
      <li>
        <a href="/2015/12/11/r-intro-1/">R Introduction Part 1</a>
      </li>
    
      <li>
        <a href="/2015/11/17/lltxdh/">李录谈现代化</a>
      </li>
    
  </ul>
</div>

	
	  
	
	  
<div class="widget tag">
  <h3 class="title">Tags</h3>
  
    <a href="/tags/R/">R<small>3</small></a>
  
    <a href="/tags/Threshold-Model/">Threshold Model<small>1</small></a>
  
    <a href="/tags/李录谈现代化/">李录谈现代化<small>1</small></a>
  
</div>

	
</div></aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="padding">
	<div class="alignleft">
	  
	  &copy; 2020 Zichao Yang
	  
	  Powerd by <a href="http://hexo.io/" target="_blank">hexo</a>
	  and Theme by <a href="https://github.com/halfer53/metro-light" target="_blank">metro-light</a>
	</div>

	<div class="alignright">
		
		
			<a href="https://github.com/Anonymous-Y" target="_blank" title="Zichao Yang Github"><i class="fa fa-github-square"></i></a>	
		
		
			<a href="https://twitter.com/Abracadabra2628" target="_blank" title="Zichao Yang Twitter"><i class="fa fa-twitter-square"></i></a>	
		
		
		
		
		
	</div>

	<div class="clearfix"></div>
</div>

<div class="scroll-top"><i class="fa fa-arrow-circle-up"></i></div></footer>
  

		<script type="text/javascript">
		var disqus_shortname = 'yzc';

		        (function() {
		            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
		            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
		        })();
		</script>

		<script type="text/javascript">
		var disqus_shortname = 'yzc'; 

		(function () {
		var s = document.createElement('script'); s.async = true;
		s.type = 'text/javascript';
		s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
		(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
		}());
		</script>

  


<script src="//cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/3.0.4/jquery.imagesloaded.js"></script>
<script src="/js/gallery.js"></script>



<script type="text/javascript">
$(window).scroll(function() {

    if($(this).scrollTop() > 400) {
        $('.scroll-top').fadeIn(200);
    } else {
        $('.scroll-top').fadeOut(200);
    }
});

$('.scroll-top').bind('click', function(e) {
    e.preventDefault();
    $('body,html').animate({scrollTop:0},200);
});
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({"HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"], linebreaks: { automatic:true }, EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50) },
        tex2jax: { inlineMath: [ ["$", "$"], ["\\(","\\)"] ], processEscapes: true, ignoreClass: "tex2jax_ignore|dno",skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']},
        TeX: {  noUndefined: { attributes: { mathcolor: "red", mathbackground: "#FFEEEE", mathsize: "90%" } }, Macros: { href: "{}" } },
        messageStyle: "none"
    }); 
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>
<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config("");
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="custom_mathjax_source">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
</body>
</html>
